# ratelimiter
限流器学习

## 基于生产者消费者模型的令牌桶
优点：
- 模型清晰，拥有独立生产令牌的对象
- 令牌可积累，可以同时并发更多的线程，感觉意义不大

缺点：
- 存在队列竞争，高并发场景下性能不好
- 无法保证线程的顺序

其他：排队线程处于block状态。

优化：使用两个阻塞队列，一个用于存放令牌，一个用于存放收到的请求，用一个独立线程去获取令牌，获取到令牌之后在请求队列中拿出一个来处理。优化后锁竞争从N个线程缩减为0

## 基于时间的令牌桶guava RateLimiter
优点：锁粒度更小，高并发场景下性能优于生产消费者模型

缺点：
- 依然存在一个锁竞争，通过一个单点锁去计算每个线程的等待执行时间。
- 即使有预热功能，由于没有拒绝功能也会导致CPU水位过高。

其他：排队线程出于wait状态。

优化：增加一个阻塞队列，请求来了先入队，再依次去计算等待时间，避免加锁。

## 漏桶
优点：超过桶的容量后请求会被拒绝。无锁竞争。

缺点：暂时没想到
